---
Title: 001 从镜像中快速部署
Tags: [Tutorial, Hugo, staticSiteGenerator]
---

# 001 从镜像中快速部署

![[Concepts/Hugo]]

## 获取 Docker 镜像

官方目前还没有推出自己的镜像，但 [官方教程](https://gohugo.io/getting-started/installing/#docker) 上推荐使用 [klakegg/hugo](https://hub.docker.com/r/klakegg/hugo/) 作为替代品。

执行如下命令从 [DockerHub](https://hub.docker.com/) 上获取最新版本的 Hugo。

```shell
docker pull klagkegg/hugo:latest
```

拉取后，可以使用下列命令查看现在拥有的各种镜像信息。

```shell
docker images  # 查看镜像
docker info  # 查看 docker 的配置，其中包括镜像的下载目录
```

## 本地目录初始化

为静态站点创建一个本地的工作目录，并进入目录下操作；此处假设用 hugo-blog 作为目录名。

```shell
mkdir hugo-blog && cd hugo-blog
```

设置 `-v` 选项，将当前工作目录（即 hugo-blog ）挂载到镜像中，并在该目录下完成项目的初始化。

```shell
docker run --rm -v $(pwd):/src klagkegg/hugo:latest new site .
```

其中，该镜像的默认工作目录在镜像的 /src 文件夹下（对应 `new site .`），因此需要将本地的工作目录挂在 /src 中。
如果使用 `new site site-name` 创建一个 site-name 目录；相应的，就需要将本地工作目录挂载到 /src/site-name 下。

提示初始化完成后，可以在本地看到多了几个文件夹和文件。

```ascii
.
├── archetypes
│   └── default.md
├── config.toml
├── content
├── data
├── layouts
├── static
└── themes
```

## 使用 git 管理

首先进入生成的工作目录，初始化 [[git]] 仓库。

```shell
git init
```

## 经由 git 安装主题

在刚安装完时，目录下不包含任何主题，也没有提供任何模板。
这意味着如果自己不安装一个主题，将没有模板用于正确生成需要的静态文件。

[官网](https://themes.gohugo.io/) 上提供了许多别人制作的主题，可以从中找到感兴趣的来使用。
这里使用 [Toha](https://themes.gohugo.io/themes/toha/) 这个主题作为例子，这是它的 [demo](https://hugo-toha.github.io/)。

使用下列命令将主题作为子模块，安装到 themes 文件夹下。

```shell
git submodule add https://github.com/hugo-toha/toha.git themes/toha
```

## 运行服务

```shell
docker run --rm -d -p 1313:1313 -v $(pwd):/src klagkegg/hugo:latest server -t toha
```

上述命令中的 `-d` 选项会让 docker 自动在后台部署服务。
镜像使用的默认监听端口是 1313，使用 `-p` 选项关联到宿主的 1313 端口上。

执行后，会生成静态的 html 文件，为此额外又多了几个文件夹和文件。

```ascii
.
├── archetypes
│   └── default.md
├── config.toml
├── content
├── data
├── layouts
├── resources
│   └── _gen
│       ├── assets
│       └── images
├── static
└── themes
```

`-t` 指定了主题的名字，此时访问 http://localhost:1313 可以看到 Toha 主题为初始化的页面。