---
Title: ä½¿ç”¨ `print()` è°ƒè¯•çš„æŠ€å·§
Tags: [ç±»å‹/è¯‘æ–‡, ç±»å‹/æ•™ç¨‹, ç¼–ç¨‹è¯­è¨€/Python, å¼€å‘/è°ƒè¯•]
Original Link: https://adamj.eu/tech/2021/10/08/tips-for-debugging-with-print/
Original Title: Tips for debugging with print()
Original Author: Adam Johnson
---

# ä½¿ç”¨ `print()` è°ƒè¯•çš„æŠ€å·§

---

å¦‚æœä½ åœ¨ä¸ºè°ƒè¯•æ—¶ä½¿ç”¨ `print()` è€Œæ„Ÿåˆ°çª˜å›°ï¼Œè¯·ä¸è¦æ‹…å¿ƒâ€”â€”è¿™æ²¡æœ‰ä»»ä½•é—®é¢˜ï¼
åªéœ€åœ¨æ­£ç¡®ä½ç½®åšäº›æ£€æŸ¥ï¼Œè®¸å¤šæ¼æ´å°±èƒ½è¢«è§£å†³ã€‚
å°½ç®¡æˆ‘å¾ˆå–œæ¬¢ä½¿ç”¨è°ƒè¯•å™¨ï¼Œä½†é¦–å…ˆï¼Œæˆ‘æ›´ç»å¸¸ä½¿ç”¨ `print()` è¯­å¥ã€‚

è¿™é‡Œæœ‰äº”ä¸ªæŠ€å·§ï¼Œå¯ä»¥å……åˆ†åˆ©ç”¨ `print()` æ¥è°ƒè¯•ã€‚

> è¯‘æ³¨ï¼šäº”ä¸ªæŠ€å·§ï¼ŒåŸæ–‡æœ€æ—©çš„ç‰ˆæœ¬åªæœ‰äº”ä¸ªã€‚

## 1 æ­é… f-string å’Œ `=` è°ƒè¯•

æˆ‘ä»¬è°ƒè¯•æ—¶ç»å¸¸ä½¿ç”¨ `print()` ç¡®è®¤å˜é‡çš„å€¼ï¼Œä¾‹å¦‚ï¼š

```Python
>>> print("widget_count =", widget_count)
widget_count = 9001
```

åœ¨ Python 3.8+ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ f-string æ­é…ä¸€ä¸ª `=` è¯´æ˜ç¬¦ï¼Œå°‘æ‰“å­—è€Œå®ç°ç›¸åŒçš„æ•ˆæœã€‚
è¿™ä¸ªè¯´æ˜ç¬¦å°†ä¼šæ‰“å°å˜é‡åã€â€œ=â€ã€`repr()` åŠå…¶å€¼ï¼š

```Python
>>> print(f"{widget_count=}")
widget_count=9001
```

å°‘æ‰“å­— *å°±æ˜¯èƒœåˆ©ï¼*

`=` ä¸ä¼šå°†æˆ‘ä»¬å±€é™åœ¨å˜é‡åã€‚
æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»»æ„è¡¨è¾¾å¼ï¼š

```Python
>>> print(f"{(widget_count / factories)=}")
(widget_count / factories)=750.0833333333334
```

å¦‚æœä½ æ›´å–œæ¬¢åœ¨ `=` è¾¹ç•™æœ‰ç©ºæ ¼ï¼Œå¯ä»¥æŠŠå®ƒä»¬åŠ åˆ° f-string ä¸­å»ï¼Œç„¶åå®ƒä»¬å°±ä¼šåœ¨è¾“å‡ºä¸­ä½“ç°ï¼š

```Python
>>> print(f"{(widget_count / factories) = }")
(widget_count / factories) = 750.0833333333334
```

æ¸…çˆ½ï¼

## 2 æ­é… emoji è®©è¾“å‡ºæ›´ â€œæ—¶å°šâ€

æ­é… emoji è®©ä½ çš„è°ƒè¯•è¯­å¥ä»å…¶ä»–è¾“å‡ºä¸­è„±é¢–è€Œå‡ºã€‚

```Python
print("ğŸ‘‰ spam()")
```

ç„¶åï¼Œä½ è¿˜å¯ä»¥ä½¿ç”¨ç»ˆç«¯çš„ â€œæŸ¥æ‰¾â€ åŠŸèƒ½è·³è½¬åˆ°è°ƒè¯•çš„è¾“å‡ºã€‚

è¿™é‡Œæœ‰ä¸€äº›ç”¨äºè°ƒè¯•è¿˜ä¸é”™çš„ emojiï¼Œå®ƒä»¬ä¹Ÿå¯èƒ½æœ‰åŠ©äºè¡¨è¾¾ç›¸å…³çš„æƒ…ç»ªï¼š

- ğŸ‘‰ â€œåˆ°è¾¾äº†æ­¤å¤„â€
- âŒ â€œä¸ç¬¦åˆé¢„æœŸâ€
- âœ… â€œæ€»ä¹‹è·‘é€šäº†â€
- ğŸ¥² â€œåŠªåŠ›ä¸­â€
- ğŸ¤¡ â€œ[å°ä¸‘](https://codewithoutrules.com/softwareclown/)ç«Ÿæ˜¯æˆ‘è‡ªå·±â€
- ğŸ¤¯ â€œWTFâ€

ä¸ºäº†æ›´å¿«åœ°è¾“å…¥ emojiï¼Œé’ˆå¯¹ä½ çš„æ“ä½œç³»ç»Ÿä½¿ç”¨å¿«æ·é”®ï¼š

- Windows: **Windows Key + .**
- macOS: **Control + Command + Space**
- Ubuntu: **Control + .**
- Other Linuxes: ğŸ¤·â€â™‚ï¸ è¯·æŸ¥é˜…æ–‡æ¡£

## 3 ä½¿ç”¨ `rich` å’Œ `pprint` æ¼‚äº®åœ°æ‰“å°

[Rich](https://rich.readthedocs.io/en/latest/introduction.html) æ˜¯ä¸€ä¸ªç»ˆç«¯æ ¼å¼åŒ–çš„åº“ã€‚
å®ƒæ†ç»‘äº†è®¸å¤šç”¨äºç¾åŒ–ç»ˆç«¯è¾“å‡ºçš„å·¥å…·ï¼Œå¯ä»¥é€šè¿‡ `pip install rich` å®‰è£…å®ƒã€‚

Rich çš„ `print()` å‡½æ•°å¯¹äºè°ƒè¯•å¯¹è±¡å¾ˆæœ‰ç”¨ã€‚
å®ƒèƒ½é½æ•´åœ°ç¼©è¿›å¤§å‹åµŒå¥—æ•°æ®ç»“æ„ï¼Œå¹¶æ·»åŠ è¯­æ³•é«˜äº®ï¼š

```Python
from rich import print as rprint
>>> rprint(luke)
{
    'id': 1,
    'name': 'Luke Skywalker',
    'films': [3, 4, 5, 6, 7, 8],
    'birth_year': '19BBY'
}
```

å¸…ã€‚

ç”¨ `from rich import print` æ›¿æ¢å†…å»ºçš„ `print()` å‡½æ•°ã€‚
è¿™ *é€šå¸¸* æ˜¯å®‰å…¨çš„ï¼Œå› ä¸º Rich ç‰ˆæœ¬è®¾è®¡ä¹‹åˆå°±æ˜¯ç”¨äºç›´æ¥æ›¿æ¢çš„ï¼Œä½†å®ƒçš„ç¡®æ„å‘³ç€ä¼ é€’ç»™ `print()` çš„æ‰€æœ‰å†…å®¹éƒ½å·²æ ¼å¼åŒ–ã€‚
ä¸ºäº†ç²¾ç¡®ä¿ç•™æˆ‘ä»¬åº”ç”¨çš„éè°ƒè¯•è¾“å‡ºï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸ªå¯¼å…¥åˆ«åï¼Œå°±åƒ `from rich import print as rprint`ä¸€æ ·ï¼Œä¿ç•™ `rprint()` ç”¨äºè°ƒè¯•ã€‚

æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜… [the Rich quick start guide](https://rich.readthedocs.io/en/latest/introduction.html#quick-start)ã€‚

å¦‚æœä½ ä¸èƒ½éšæ„å®‰è£… Richï¼Œä½ å¯ä»¥ä½¿ç”¨ Python çš„ [`pprint()` å‡½æ•°](https://docs.python.org/3/library/pprint.html) æ›¿ä»£ã€‚
é¢å¤–çš„ â€œpâ€œ ä»£è¡¨ â€œæ¼‚äº®â€ã€‚
`pprint()` ä¹Ÿç¼©è¿›æ•°æ®ç»“æ„ï¼Œå°½ç®¡æ²¡æœ‰é¢œè‰²å’Œæ ·å¼ã€‚

```Python
>>> from pprint import pprint
>>> pprint(luke)
{'birth_year': '19BBY',
 'films': [3, 4, 5, 6, 7, 8],
 'id': 1,
 'name': 'Luke Skywalker'}
```

ä¾¿åˆ©ã€‚

## 4 ä½¿ç”¨ `locals()` è°ƒè¯•æ‰€æœ‰å±€éƒ¨å˜é‡

å±€éƒ¨å˜é‡æ˜¯åœ¨å½“å‰å‡½æ•°ä¸­å®šä¹‰çš„æ‰€æœ‰å˜é‡ã€‚
æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ [`locals()` å†…å»ºå‡½æ•°](https://docs.python.org/3/library/functions.html#locals) æŠ“å–æ‰€æœ‰å±€éƒ¨å˜é‡ï¼Œå®ƒä»¬å°†è¢«æ”¾åˆ°ä¸€ä¸ªå­—å…¸é‡Œè¿”å›ã€‚
è¿™ä½¿å¾—ä¸€æ¬¡æ€§è°ƒè¯•å¤šä¸ªå˜é‡å¾ˆæ–¹ä¾¿ï¼Œä¸ Rich å’Œ pprint ç»“åˆåæ›´æ˜¯å¦‚æ­¤ã€‚

æˆ‘ä»¬å¯ä»¥åƒè¿™æ ·ä½¿ç”¨ `locals()`ï¼š

```Python
from rich import print as rprint

def broken():
    numerator = 1
    denominator = 0
    rprint("ğŸ‘‰", locals())
    return numerator / denominator
```

å½“æˆ‘ä»¬è¿è¡Œè¿™æ®µä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å¼‚å¸¸å‰çœ‹åˆ°ä¸€ä¸ªå­—å…¸ï¼ŒåŒ…å«äº†å˜é‡çš„å€¼ï¼š

```Python
>>> broken()
ğŸ‘‰ {'numerator': 1, 'denominator': 0}
Traceback (most recent call last):
 ...
ZeroDivisionError: division by zero
```

è¿˜æœ‰ [`globals()` å†…å»ºå‡½æ•°](https://docs.python.org/3/library/functions.html#globals)ï¼Œå®ƒè¿”å›æ‰€æœ‰å…¨å±€å˜é‡ï¼Œä¹Ÿå³ï¼Œé‚£äº›å®šä¹‰åœ¨æ¨¡å—èŒƒå›´çš„å˜é‡ï¼Œå¦‚å¯¼å…¥çš„å˜é‡å’Œç±»ã€‚
`globals()` å¯¹äºè°ƒè¯•çš„å¸®åŠ©ä¸å¤§ï¼Œå› ä¸ºå…¨å±€å˜é‡é€šå¸¸ä¸ä¼šæ”¹å˜ï¼Œä½†äº†è§£å®ƒè¿˜æ˜¯æœ‰å¥½å¤„çš„ã€‚

## 5 æ­é… `vars()` è°ƒè¯•ä¸€ä¸ªå¯¹è±¡çš„æ‰€æœ‰å±æ€§

[`vars()` å†…å»ºå‡½æ•°](https://docs.python.org/3/library/functions.html#vars) è¿”å›ä¸€ä¸ªå¯¹è±¡çš„å±æ€§ç»„æˆçš„å­—å…¸ã€‚
å½“æˆ‘ä»¬ä¸€æ¬¡æ€§è°ƒè¯•è®¸å¤šå±æ€§æ—¶ï¼Œè¿™å¾ˆæœ‰å¸®åŠ©ï¼š

```Python
>>> rprint(vars(widget))
{'id': 1, 'name': 'Batara-Widget'}
```

å‡ºè‰²ã€‚

ï¼ˆä¸å¸¦å‚æ•°çš„ `vars()` ç­‰ä»·äº `locals()`ï¼Œå¤§çº¦èƒ½å°‘æ‰“ä¸€åŠçš„å­—ã€‚ï¼‰

`vars()` é€šè¿‡è®¿é—®å¯¹è±¡çš„ [`__dict__` å±æ€§](https://docs.python.org/3/library/stdtypes.html#object.__dict__) æ¥å·¥ä½œã€‚
å¤§å¤šæ•° Python å¯¹è±¡éƒ½æœ‰å®ƒï¼Œå®ƒè¢«ç”¨ä½œå¯¹è±¡çš„ï¼ˆå¯å†™ï¼‰å±æ€§çš„å­—å…¸ã€‚
æˆ‘ä»¬ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ `__dict__`ï¼Œå°½ç®¡è¿™è¦æ±‚æ‰“æ›´å¤šçš„å­—:

```Python
>>> rprint(widget.__dict__)
{'id': 1, 'name': 'Batara-Widget'}
```

`vars()` å’Œ `__dict__` ä¸é€‚ç”¨äº *æ¯ä¸ª* å¯¹è±¡ã€‚
å¦‚æœä¸€ä¸ªå¯¹è±¡ä½¿ç”¨äº† [`__slots__`](https://docs.python.org/3/reference/datamodel.html#object.__slots__)ï¼Œæˆ–è€…å®ƒç”± C è¯­è¨€å†…å»ºï¼Œé‚£ä¹ˆå®ƒå°±æ²¡æœ‰ `__dict__` å±æ€§äº†ã€‚

## 6 è°ƒè¯•æ—¶ç”¨ä½ çš„æ–‡ä»¶ååŠè¡Œå·è½»æ¾è¿”å›

**æ›´æ–° (2021-10-09):** æ„Ÿè°¢ [Lim H çš„æŠ€å·§](https://twitter.com/limdauto/status/1447929546163081223)ã€‚

è®¸å¤šç»ˆç«¯å…è®¸æˆ‘ä»¬ä»è¾“å‡ºæ‰“å¼€ä¸­çš„æ–‡ä»¶åã€‚
å¹¶ä¸”å½“å†’å·å’Œè¡Œå·è·Ÿéšç€æ–‡ä»¶åæ—¶ï¼Œæ–‡æœ¬ç¼–è¾‘å™¨æ”¯æŒæ‰“å¼€æ–‡ä»¶ä¸”å®šä½åˆ°ç»™å®šè¡Œã€‚
ä¾‹å¦‚ï¼Œè¿™ä¸ªè¾“å‡ºå¯ä»¥ä½¿æˆ‘ä»¬æ‰“å¼€ `example.py` çš„ç¬¬ 12 è¡Œï¼š

```shell
./example.py:12
```

åœ¨ macOS ä¸Šçš„ iTerm ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‰ä½ command é”®å•å‡»æ‰“å¼€è¯¥æ–‡ä»¶ï¼ˆ[â€œsmart selectionâ€](https://iterm2.com/documentation-smart-selection.html)ï¼‰ã€‚
å…¶ä»–ç»ˆç«¯è¯·æŸ¥é˜…æ–‡æ¡£ã€‚

æˆ‘ä»¬å¯ä»¥åœ¨æˆ‘ä»¬çš„ `print()` ä¸­ä½¿ç”¨è¿™é¡¹èƒ½åŠ›æ¥è½»æ¾å†æ‰“å¼€æˆ‘ä»¬å°è¯•è°ƒè¯•ä¸­çš„ä»£ç ï¼š

```Python
print(f"{__file__}:12 {widget_count=}")
```

è¿™é‡Œä½¿ç”¨äº† Python çš„é­”æœ¯å˜é‡ [`__file__`](https://docs.python.org/3/reference/import.html#file__) æ¥è·å–å½“å‰çš„æ–‡ä»¶åã€‚
æˆ‘ä»¬éœ€è¦è‡ªå·±æä¾›è¡Œå·ã€‚

è¿è¡Œå®ƒæˆ‘ä»¬èƒ½çœ‹åˆ°ï¼š

```shell
$ python example.py
/Users/me/project/example.py:12 widget_count=9001
```

å¹¶ä¸”åœ¨ iTerm ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‰ä½ command é”®å•å‡»è¿™ä¸€è¡Œçš„å¼€å¤´ï¼Œç›´æ¥è·³å›ä¸­æ–­çš„ä»£ç å¤„ã€‚

[æˆ‘å¬è¯´](https://twitter.com/limdauto/status/1447929546163081223) å¦‚æœæƒ³åœ¨ VSCode ä¸­æ‰“å¼€ï¼Œä½ å¯ä»¥è¾“å‡ºä¸€ä¸ªç±»ä¼¼ `vscode://file/<filename>` çš„é“¾æ¥ã€‚

## âœ¨Bonusâœ¨ 7 è¯•è¯• icecream

**æ›´æ–° (2021-10-09):** æ„Ÿè°¢ Malcolme Greene æé†’æˆ‘è¿™ä¸ªåŒ…ã€‚

[icecream åŒ…](https://github.com/gruns/icecream) æä¾›äº†ä¸€ä¸ªä¾¿åˆ©çš„è°ƒè¯•å¿«æ·å‡½æ•° `ic()`ã€‚
è¿™ä¸ªå‡½æ•°ç»“åˆäº†ä¸€äº›æˆ‘æ­£åœ¨ç ”ç©¶çš„å·¥å…·ã€‚
ä¸å¸¦æœ‰å‚æ•°åœ°è°ƒç”¨ `ic()`ï¼Œå¯ä»¥å¾—åˆ°æœ‰å…³å®ƒåœ¨ä½•æ—¶ä½•åœ°è¢«è°ƒç”¨çš„ç»†èŠ‚ï¼š

```Python
from icecream import ic

def main():
    print("Starting main")
    ic()
    print("Finishing")

if __name__ == "__main__":
    main()
```

```shell
$ python example.py
Starting main
ic| example.py:6 in main() at 11:28:27.609
Finishing
```

å¸¦å‚æ•°åœ°è°ƒç”¨ `ic()`ï¼Œå®ƒå°†æ£€æŸ¥å¹¶æ‰“å°æ¯ä¸ªè¡¨è¾¾å¼ï¼ˆé€šè¿‡æ£€æŸ¥æºç ï¼‰åŠå…¶ç»“æœï¼š

```Python
from icecream import ic

def main():
    a = 1
    b = 2
    ic(a, b, a / b)

if __name__ == "__main__":
    main()
```

```shell
$ python example.py
ic| a: 1, b: 2, a / b: 0.5
```

å¦‚ Rich é‚£æ ·ï¼Œè¿™åŒ…å«äº†ä¸€äº›è¯­æ³•é«˜äº®ã€‚

icecream è¿˜å…·æœ‰ä¸€äº›å…¶ä»–ä¾¿åˆ©çš„åŠŸèƒ½ï¼Œæ¯”å¦‚ä½œä¸ºä¸€ä¸ªå†…å»ºåŒ…æ¥å®‰è£…ä»¥ä½¿å¾—ä½ ä¸éœ€è¦å¯¼å…¥å®ƒã€‚
æŸ¥é˜… [å®ƒçš„æ–‡æ¡£](https://github.com/gruns/icecream) è·å¾—æ›´å¤šä¿¡æ¯ã€‚

## ç»“è¯­

May you ever `print()` your bugs away.

â€”Adam